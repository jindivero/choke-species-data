View(o2)
weighted_average <- readRDS("~/Library/CloudStorage/Dropbox/Pollock/for_github/data/model_processed_outputs/weighted_average.rds")
View(weighted_average)
model_index_weight <- readRDS("~/Library/CloudStorage/Dropbox/Pollock/for_github/data/model_processed_outputs/model_index_weight.rds")
View(model_index_weight)
View(weighted_average)
library(devtools)
install.packages("Matrix", dependencies=TRUE, force=TRUE)
library(readxl)
library(lubridate)
install.packages("ggpubr")
library(ggpubr)
#Set ggplot themes
theme_set(theme_bw(base_size = 25))
theme_update(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
source("test_data/code/convert_funs.R")
### Thompson-gathered in situ data
thompson <- readRDS("data/oxygen options/PotentialDensityData.RDS")
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
setwd(basewd)
source("test_data/code/convert_funs.R")
### Thompson-gathered in situ data
thompson <- readRDS("data/oxygen options/PotentialDensityData.RDS")
#Convert O2
thompson$O2_umolkg <- convert_o2(thompson$do_mlpL, thompson$sigma0_kgm3)
#Isolate just the DFO data
dfo <- subset(thompson, Survey=="DFO_Pacific")
#Convert pressure to depth
dfo$depth <- p2d(lat = dfo$latitude,
p = dfo$p_dbar)
#Try to match to haul data
haul_qc <- read.csv("data/fish_raw/BC/QCS_effort.csv")
haul_vi <- read.csv("data/fish_raw/BC/WCVI_effort.csv")
haul_hs <- read.csv("data/fish_raw/BC/HS_effort.csv")
haul_hg <- read.csv("data/fish_raw/BC/WCHG_effort.csv")
library(readxl)
library(lubridate)
library(seacarb)
#Convert pressure to depth
dfo$depth <- p2d(lat = dfo$latitude,
p = dfo$p_dbar)
#Try to match to haul data
haul_qc <- read.csv("data/fish_raw/BC/QCS_effort.csv")
haul_vi <- read.csv("data/fish_raw/BC/WCVI_effort.csv")
haul_hs <- read.csv("data/fish_raw/BC/HS_effort.csv")
haul_hg <- read.csv("data/fish_raw/BC/WCHG_effort.csv")
#Combine BC bio and haul data to combine together
haul2 <- rbind(haul_hg, haul_hs, haul_qc, haul_vi)
haul_bc <- haul2[,c("Survey.Year", "Set.date", "Start.latitude", "Start.longitude", "Bottom.depth..m.")]
colnames(haul_bc) <- c("year", "date", "latitude", "longitude", "depth_haul")
dfo <- left_join(dfo, haul_bc, by=c("year", "latitude", "longitude"))
dfo <- dfo[,c("Survey", "year", "month", "date", "latitude", "longitude", "salinity", "temperature_C", "p_dbar", "do_mlpL", "sigma0_kgm3","O2_umolkg","depth_haul")]
colnames(dfo) <- c("survey", "year", "month", "date", "latitude", "longitude", "salinity_psu", "temperature_C", "p_dbar", "do_mlpL", "sigma0_kgm3","O2_umolkg","depth")
dfo$date <- as.POSIXct(dfo$date,format = "%Y-%m-%d")
library(dplyr)
#Combine BC bio and haul data to combine together
haul2 <- rbind(haul_hg, haul_hs, haul_qc, haul_vi)
haul_bc <- haul2[,c("Survey.Year", "Set.date", "Start.latitude", "Start.longitude", "Bottom.depth..m.")]
colnames(haul_bc) <- c("year", "date", "latitude", "longitude", "depth_haul")
dfo <- left_join(dfo, haul_bc, by=c("year", "latitude", "longitude"))
dfo <- dfo[,c("Survey", "year", "month", "date", "latitude", "longitude", "salinity", "temperature_C", "p_dbar", "do_mlpL", "sigma0_kgm3","O2_umolkg","depth_haul")]
colnames(dfo) <- c("survey", "year", "month", "date", "latitude", "longitude", "salinity_psu", "temperature_C", "p_dbar", "do_mlpL", "sigma0_kgm3","O2_umolkg","depth")
dfo$date <- as.POSIXct(dfo$date,format = "%Y-%m-%d")
dfo<- dfo %>%
st_as_sf(coords=c('longitude','latitude'),crs=4326,remove = F) %>%
st_transform(crs = "+proj=utm +zone=10 +datum=WGS84 +units=km") %>%
mutate(X=st_coordinates(.)[,1],Y=st_coordinates(.)[,2])
library(sf)
#Convert coordiantes
nwfsc2 <- nwfsc2 %>%
st_as_sf(coords=c('longitude','latitude'),crs=4326,remove = F) %>%
st_transform(crs = "+proj=utm +zone=10 +datum=WGS84 +units=km") %>%
mutate(X=st_coordinates(.)[,1],Y=st_coordinates(.)[,2])
dfo<- dfo %>%
st_as_sf(coords=c('longitude','latitude'),crs=4326,remove = F) %>%
st_transform(crs = "+proj=utm +zone=10 +datum=WGS84 +units=km") %>%
mutate(X=st_coordinates(.)[,1],Y=st_coordinates(.)[,2])
#NWFSC trawl survey data
nwfsc <- readRDS("data/oxygen options/joined_nwfsc_data.RDS")
#Unique hauls
nwfsc2 <- distinct(nwfsc, trawl_id, .keep_all = TRUE)
#Columns of interest
nwfsc2 <- nwfsc2[,c("trawl_id", "year", "date", "longitude_dd", "latitude_dd", "o2", "temp", "sal", "depth")]
colnames(nwfsc2) <- c("event_id", "year", "date", "longitude", "latitude", "do_mlpL", "temperature_C", "salinity_psu", "depth")
View(thompson)
thompson <- density_O2
density_O2 <- thompson
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
View(density_O2)
View(density_O2)
View(density_no_O2)
library(tidync)
library(lubridate)
library(sf)
library(dplyr)
library(tidyr)
install.packages("sdmTMB", type="source")
library(sdmTMB)
library(seacarb)
library(respR)
library(ggplot2)
install.packages("Metrics")
library(Metrics)
### Set ggplot themes ###
theme_set(theme_bw(base_size = 25))
theme_update(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#Set WD
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
setwd(basewd)
#Function
rsq <- function (x, y) cor(x, y) ^ 2
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
#Log O2 and get DOY
density_O2$O2_umolkg_ln <- log(density_O2$O2_umolkg)
density_O2$depth_ln <- log(density_O2$depth)
density_O2$sigma0_exp <- exp(density_O2$sigma0_kgm3)
density_O2$doy <- as.POSIXlt(density_O2$date, format = "%Y-%b-%d")$yday
#Remove alaska for now, until we figure out what's going on with the units
density_O2 <- subset(density_O2, survey!="afsc")
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2 <- density_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
#Separate train and test data
set.seed(7)
density_O2$test <- rbinom(n = nrow(density_O2), size = 1, prob = 0.3)
train <- density_O2[density_O2$test == 0,]
test <- density_O2[density_O2$test == 1,]
train <- as.data.frame(train)
test <- as.data.frame(test)
#Log O2 and get DOY
density_O2$O2_umolkg_ln <- log(density_O2$O2_umolkg)
density_O2$depth_ln <- log(density_O2$depth)
density_O2$sigma0_exp <- exp(density_O2$sigma0_kgm3)
density_O2$doy <- as.POSIXlt(density_O2$date, format = "%Y-%b-%d")$yday
#Remove alaska for now, until we figure out what's going on with the units
density_O2 <- subset(density_O2, survey!="afsc")
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
View(density_O2)
View(density_no_O2)
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
#Log O2 and get DOY
density_O2$O2_umolkg_ln <- log(density_O2$O2_umolkg)
density_O2$depth_ln <- log(density_O2$depth)
density_O2$sigma0_exp <- exp(density_O2$sigma0_kgm3)
density_O2$doy <- as.POSIXlt(density_O2$date, format = "%Y-%b-%d")$yday
#Remove alaska for now, until we figure out what's going on with the units
density_O2 <- subset(density_O2, survey!="afsc")
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2 <- density_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
#Set WD
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
setwd(basewd)
#Function
rsq <- function (x, y) cor(x, y) ^ 2
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
#Log O2 and get DOY
density_O2$O2_umolkg_ln <- log(density_O2$O2_umolkg)
density_O2$depth_ln <- log(density_O2$depth)
density_O2$sigma0_exp <- exp(density_O2$sigma0_kgm3)
density_O2$doy <- as.POSIXlt(density_O2$date, format = "%Y-%b-%d")$yday
View(density_O2)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2_2 <- density_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
View(density_O2_2)
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2_2 <- density_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
#Log O2 and get DOY
density_O2$O2_umolkg_ln <- log(density_O2$O2_umolkg)
density_O2$depth_ln <- log(density_O2$depth)
density_O2$sigma0_exp <- exp(density_O2$sigma0_kgm3)
density_O2$doy <- as.POSIXlt(density_O2$date, format = "%Y-%b-%d")$yday
#Remove NAs (was causing issues with smoother if had NAs)
density_O2_2 <- density_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
View(density_O2)
View(density_O2_2)
density_O2 <- density_O2 %>% filter_at(vars(temperature_C, depth_ln, month, sigma0_exp), is.na())
density_O2 <- density_O2 %>% filter_at(vars(temperature_C, depth_ln, month, sigma0_exp), is.na(any_vars()))
View(density_O2)
View(density_O2)
### Thompson-gathered in situ data
thompson <- readRDS("data/oxygen options/PotentialDensityData.RDS")
View(thompson)
test <- subset(thompson, Survey="IPHC")
test <- subset(thompson, Survey=="IPHC")
View(test)
density_O2 <- thompson
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
View(density_O2)
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
#Log O2 and get DOY
density_O2$O2_umolkg_ln <- log(density_O2$O2_umolkg)
density_O2$depth_ln <- log(density_O2$depth)
density_O2$sigma0_exp <- exp(density_O2$sigma0_kgm3)
density_O2$doy <- as.POSIXlt(density_O2$date, format = "%Y-%b-%d")$yday
#Remove alaska for now, until we figure out what's going on with the units
density_O2 <- subset(density_O2, survey!="afsc")
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2 <- density_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
View(density_O2)
test <- subset(density_O2, survey=="iphc")
View(test)
#IPHC data
iphc <-  read_excel("~/Dropbox/choke species/code/choke-species-data/data/fish_raw/IPHC/IPHC_FISS_set_halibut.xlsx")
colnames(iphc) <- tolower(colnames(iphc))
test <- subset(iphc, year==2016|year==2017|year==2018)
View(test)
View(test)
View(density_O2)
View(thompson)
library(tidync)
library(lubridate)
library(sf)
library(dplyr)
library(tidyr)
install.packages("sdmTMB", type="source")
library(sdmTMB)
library(seacarb)
library(respR)
library(ggplot2)
install.packages("Metrics")
library(Metrics)
### Set ggplot themes ###
theme_set(theme_bw(base_size = 25))
theme_update(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#Set WD
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
setwd(basewd)
#Function
rsq <- function (x, y) cor(x, y) ^ 2
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
#Log O2 and get DOY
density_O2$O2_umolkg_ln <- log(density_O2$O2_umolkg)
density_O2$depth_ln <- log(density_O2$depth)
density_O2$sigma0_exp <- exp(density_O2$sigma0_kgm3)
density_O2$doy <- as.POSIXlt(density_O2$date, format = "%Y-%b-%d")$yday
#Remove alaska for now, until we figure out what's going on with the units
density_O2 <- subset(density_O2, survey!="afsc")
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2 <- density_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
View(density_no_O2)
View(density_no_O2)
#Plot
density_no_O2 <- density_no_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
ggplot(density_no_O2, aes(x=latitude,y=longitude, colour=survey)+geom_point()+facet_wrap("year")
ggplot(density_no_O2, aes(x=latitude,y=longitude, colour=survey))+geom_point()+facet_wrap("year")
ggplot(density_no_O2, aes(x=latitude,y=longitude, colour=survey))+geom_point()+facet_wrap("year")
ggplot(density_no_O2, aes(x=X,y=Y, colour=survey))+geom_point()+facet_wrap("year")
# load, clean, and join data
bio2 <-readRDS("data/fish_raw/NOAA/ak_bts_goa_ebs_nbs_all_levels.RDS")
catch2 <- readRDS("data/fish_raw/NOAA/ak_bts_goa_ebs_nbs_cpue_zerofilled.RDS")
#Isolate necessary parts of full data to get specimen weights/lengths per haul
haul <- bio2$haul
specimen <- bio2$specimen
species <- bio2$species
size <- bio2$size
#make lowercase
names(haul) <- tolower(names(haul))
names(specimen) <- tolower(names(specimen))
names(species) <- tolower(names(species))
names(size) <- tolower(names(bio2$size))
species$species_name <- tolower(species$species_name)
ggplot(density_O2, aes(x=X,y=Y, colour=survey))+geom_point()+facet_wrap("year")
View(haul)
#Set WD
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
#Set WD
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
setwd(basewd)
library(tidync)
library(lubridate)
library(sf)
library(dplyr)
library(tidyr)
install.packages("sdmTMB", type="source")
library(sdmTMB)
library(seacarb)
library(respR)
library(ggplot2)
install.packages("Metrics")
library(Metrics)
### Set ggplot themes ###
theme_set(theme_bw(base_size = 25))
theme_update(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#Set WD
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
setwd(basewd)
#Function
rsq <- function (x, y) cor(x, y) ^ 2
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
#Log O2 and get DOY
density_O2$O2_umolkg_ln <- log(density_O2$O2_umolkg)
density_O2$depth_ln <- log(density_O2$depth)
density_O2$sigma0_exp <- exp(density_O2$sigma0_kgm3)
density_O2$doy <- as.POSIXlt(density_O2$date, format = "%Y-%b-%d")$yday
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2 <- density_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
ggplot(density_O2, aes(x=X,y=Y, colour=survey))+geom_point()+facet_wrap("year")
#Alaska specifically
ggplot(density_O2, aes(x=X,y=Y, colour=survey))+geom_point()+facet_wrap("year")+xlim(-2000,-3000)+ylim(7000,8000)
View(density_O2)
View(density_no_O2)
View(density_O2)
#Columns of interest
iphc <- iphc[,c("year", "date", "beginlat", "beginlon", "begindepth (fm)", "temp c", "salinity psu", "oxygen_ml")]
colnames(iphc) <- c("year", "date", "latitude", "longitude", "depth", "temperature_C", "salinity_psu", "do_mlpL")
#IPHC data
iphc <-  read_excel("~/Dropbox/choke species/code/choke-species-data/data/fish_raw/IPHC/IPHC_FISS_set_halibut.xlsx")
colnames(iphc) <- tolower(colnames(iphc))
View(iphc)
### Set ggplot themes ###
theme_set(theme_bw(base_size = 25))
theme_update(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#Set WD
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
setwd(basewd)
#Function
rsq <- function (x, y) cor(x, y) ^ 2
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
#Plot available data
#Subset to data with DO available and no DO
density_no_O2 <- density_O2 %>%
filter(is.na(do_mlpL)| do_mlpL<=0)
density_O2 <- density_O2 %>%
filter(!is.na(do_mlpL), do_mlpL>0)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2 <- density_O2 %>% drop_na(temperature_C, depth_ln, month, sigma0_exp)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2 <- density_O2 %>% drop_na(temperature_C, depth, month, sigma0_exp)
#Remove NAs (was causing issues with smoother if had NAs)
density_O2 <- density_O2 %>% drop_na(temperature_C, depth, month, salinity_psu)
# prepare for plotting ####
map_data <- rnaturalearth::ne_countries(scale = "large", returnclass = "sf", continent ="North America")
# crop if you want; not needed:
us_coast <- st_crop(map_data,
c(xmin = -180, ymin = 31,
xmax = -110, ymax = 75))
us_coast_proj <- sf::st_transform(map_data, crs = 32610)
# * 1000 b/c we are in UTM km for model fitting:
xlimits = c(-282853, 1025581)
ylimits = c(2349000, 7900000)
# crop if you want; not needed:
us_coast <- st_crop(map_data,
c(xmin = -180, ymin = 31,
xmax = -110, ymax = 75))
us_coast_proj <- sf::st_transform(map_data, crs = 32610)
ggplot(us_coast_proj) + geom_sf() +
geom_point(data = dat, aes(x = latitude, y = longitude, colour=survey), size = 2.0, alpha = 1.0) +
ylim(31, 75) +
facet_wrap("year")
dat <- density_O2
ggplot(us_coast_proj) + geom_sf() +
geom_point(data = dat, aes(x = latitude, y = longitude, colour=survey), size = 2.0, alpha = 1.0) +
ylim(31, 75) +
facet_wrap("year")
dat <- density_O2
ggplot(us_coast_proj) + geom_sf() +
geom_point(data = dat, aes(x = longitude, y = latitude, colour=survey), size = 2.0, alpha = 1.0) +
ylim(31, 75) +
facet_wrap("year")
ggplot(us_coast_proj) + geom_sf() +
geom_point(data = density_no_O2, aes(x = longitude, y = latitude, colour=survey), size = 2.0, alpha = 1.0) +
facet_wrap("year")
setwd("/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data")
setwd("/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data")
### Set ggplot themes ###
theme_set(theme_bw(base_size = 25))
theme_update(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
##Pull species of interest
#One species
sci_name <- "anoplopoma fimbria"
spc <- "sablefish"
dat <- prepare_data(spc=spc, sci_name=sci_name, ROMS=F)
source("/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data/code/wa_state/util_funs.R")
### Set ggplot themes ###
theme_set(theme_bw(base_size = 25))
theme_update(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
##Pull species of interest
#One species
sci_name <- "anoplopoma fimbria"
spc <- "sablefish"
dat <- prepare_data(spc=spc, sci_name=sci_name, ROMS=F)
View(dat)
ggplot(dat, aes(x=longitude, y=longitude))+geom_point(aes(colour=survey))+facet_wrap("year")
ggplot(dat, aes(x=longitude, y=longitude))+geom_point(aes(colour=project))+facet_wrap("year")
ggplot(dat, aes(x=latitude, y=longitude))+geom_point(aes(colour=project))+facet_wrap("year")
ggplot(dat, aes(x=latitude, y=longitude))+geom_point(aes(colour=region))+facet_wrap("year")
source("/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data/code/wa_state/util_funs.R")
dat <- prepare_data(spc=spc, sci_name=sci_name, ROMS=F)
View(dat)
ggplot(dat, aes(x=latitude, y=longitude))+geom_point(aes(colour=region))+facet_wrap("year")
ggplot(dat, aes(x=lat, y=lon))+geom_point(aes(colour=region))+facet_wrap("year")
ggplot(dat, aes(x=lat, y=long))+geom_point(aes(colour=region))+facet_wrap("year")
ggplot(dat, aes(x=long, y=lat))+geom_point(aes(colour=region))+facet_wrap("year")
#Set WD
basewd <-"/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data"
setwd(basewd)
#Function
rsq <- function (x, y) cor(x, y) ^ 2
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
test <- subset(density_O2, survey=="iphc" & year==2006|year==2015|year==2018)
View(test)
test <- subset(density_O2, survey=="iphc" & (year==2006|year==2015|year==2018))
ggplot(test, aes(x=longitude, y=latitude))+geom_point()+facet_wrap('year')
test$longitude <- ifelse(test$longitude>0, test$longitude-180)
test$longitude <- ifelse(test$longitude>0, test$longitude-180, test$longitude)
ggplot(test, aes(x=longitude, y=latitude))+geom_point()+facet_wrap('year')
test$longitude <- ifelse(test$longitude>0, test$longitude-360, test$longitude)
ggplot(test, aes(x=longitude, y=latitude))+geom_point()+facet_wrap('year')
test <- subset(density_O2, survey=="iphc" & (year==2006|year==2015|year==2018))
test$longitude <- ifelse(test$longitude>0, test$longitude-360, test$longitude)
ggplot(test, aes(x=longitude, y=latitude))+geom_point()+facet_wrap('year')
ggplot(test, aes(x=longitude, y=latitude))+geom_point()+facet_wrap('year')+ylim(50,70)
ggplot(test, aes(x=longitude, y=latitude))+geom_point()+facet_wrap('year')+ylim(50,60)
ggplot(test, aes(x=longitude, y=latitude))+geom_point()+facet_wrap('year')+ylim(50,60)+xlim(-190, -160)
catch <-  read_excel("~/Dropbox/choke species/code/choke-species-data/data/fish_raw/IPHC/IPHC_FISS_set_halibut.xlsx")
View(catch)
test <- subset(catch, year==2015)
test <- subset(catch, year=="2015")
test <- subset(catch, Year=="2015")
View(test)
ggplot(test, aes(x=BeginLon, y=BeginLat))+geom_point()
## Pull in combined in situ data
density_O2 <- readRDS("insitu_combined.rds")
View(density_O2)
dfo <- subset(density_O2, survey=="DFO_Pacific")
View(dfo)
library(surveyjoin)
install.packages("surveyjoin")
library(surveyjoin)
install_github("DFO-NOAA-Pacific/surveyjoin")
library(surveyjoin)
get_survey_names()
survey <- get_survey_names()
View(survey)
d <- get_data(common="sablefish", years=2000:2023,regions=c("pbs"))
d <- get_data(common="sablefish", years=2003:2023,regions=c("pbs"))
d <- get_data(common="sablefish", years=2021:2023,regions=c("pbs"))
d <- get_data(common="sablefish", years=2016:2019,regions=c("pbs"))
devtools::install_github("pfmc-assessments/nwfscSurvey")
library(nwfscSurvey)
catch = PullCatch.fn(SurveyName = "NWFSC.Combo")
View(catch)
unique(catch$Year)
saveRDS(catch, "nwfsc_catch.rds")
bio = pull_bio(SurveyName="NWFSC.Combo")
bio = pull_bio(survey="NWFSC.Combo")
saveRDS(bio, "nwfsc_bio.rds")
load("/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data/data/fish_raw/NOAA/nwfsc_haul.rda")
View(survey)
View(nwfsc_haul)
View(catch)
View(catch)
