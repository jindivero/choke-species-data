#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
View(dat_available_region2)
View(summary)
View(dat_available_region)
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
dat_available_region2[[i]] <- dat
}
View(dat_available_region2)
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
dat_available_region2[[i]] <- dat
}
dat <- bind_rows(dat_available_region[[1]])
dat$species <- spcs[[1]]
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(nrow(dat_available_region)==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(nrow(dat_available_region)==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(nrow(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(nrow(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
nrow(dat_available_region[[1]])
length(dat_available_region[[1]])
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
ggplot(dat_available_region2, aes, (y=prop_positive, x=region))+geom_col()+facet_wrap("species")
#Plot availability
ggplot(dat_available_region2, aes(y=prop_positive, x=region))+geom_col()+facet_wrap("species")
library(ggplot2)
#Plot availability
ggplot(dat_available_region2, aes(y=prop_positive, x=region))+geom_col()+facet_wrap("species")
### Set ggplot themes ###
theme_set(theme_bw(base_size = 25))
theme_update(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#Plot availability
ggplot(dat_available_region2, aes(y=prop_positive, x=region))+geom_col()+facet_wrap("species")
#Plot availability
dat_available_region2$region <- factor(dat_available_region2, levels=c("WC", "BC", "GOA", "EBS", "NBS", "IPHC")
#Plot availability
dat_available_region2$region <- factor(dat_available_region2, levels=c("WC", "BC", "GOA", "EBS", "NBS", "IPHC"))
#Plot availability
dat_available_region2$region <- factor(dat_available_region2, levels=c("WC", "BC", "GOA", "EBS", "NBS", "IPHC"))
#Plot availability
dat_available_region2$region <- as.factor(dat_available_region2, levels=c("WC", "BC", "GOA", "EBS", "NBS", "IPHC"))
#Plot availability
dat_available_region2$region <- as.factor(dat_available_region2$region, levels=c("WC", "BC", "GOA", "EBS", "NBS", "IPHC"))
?as.factor
#Plot availability
levels(dat_avaiable_region2$region) <- c("WC", "BC", "GOA", "EBS", "NBS", "IPHC"))
#Plot availability
levels(dat_avaiable_region2$region) <- c("WC", "BC", "GOA", "EBS", "NBS", "IPHC")
#Plot availability
levels(dat_available_region2$region) <- c("WC", "BC", "GOA", "EBS", "NBS", "IPHC")
ggplot(dat_available_region2, aes(y=prop_positive, x=region))+geom_col()+facet_wrap("species")
#Plot availability
levels(dat_available_region2$region) <- c("WC", "BC", "GOA", "EBS", "NBS", "IPHC")
ggplot(dat_available_region2, aes(y=prop_positive, x=as.factor(region)))+geom_col()+facet_wrap("species")
#Plot availability
dat_available_region2$region <- as.factor(dat_available_region2$region)
levels(dat_available_region2$region) <- c("WC", "BC", "GOA", "EBS", "NBS", "IPHC")
ggplot(dat_available_region2, aes(y=prop_positive, x=as.factor(region)))+geom_col()+facet_wrap("species")
View(dat_available_region2)
ggplot(dat_available_region2, aes(y=prop_no_lengths, x=as.factor(region)))+geom_col()+facet_wrap("species")
#Add column of number of positive catch hauls with lengths
dat_available_region2$pos_lengths <- dat_available_region2$total_n_hauls*(1-dat_availabl_region2$prop_no_lengths)
#Add column of number of positive catch hauls with lengths
dat_available_region2$pos_lengths <- dat_available_region2$total_n_hauls*(1-dat_available_region2$prop_no_lengths)
ggplot(dat_available_region2, aes(y=pos_lengths, x=as.factor(region)))+geom_col()+facet_wrap("species")
dat_available_region2$pos_hauls <- dat_available_region2$total_n_hauls*dat_available_region2$prop_positive
dat_available_region2$pos_hauls_length <- dat_available_region2$pos_lengths/dat_available_region2$pos_hauls
ggplot(dat_available_region2, aes(y=pos_lengths, x=as.factor(region)))+geom_col()+facet_wrap("species")+ylab("Proportion of positive-catch hauls with length data")
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
#Add column of number of positive catch hauls with lengths
dat_available_region2$pos_lengths <- dat_available_region2$total_n_hauls*(1-dat_available_region2$prop_no_lengths)
dat_available_region2$pos_hauls <- dat_available_region2$total_n_hauls*dat_available_region2$prop_positive
dat_available_region2$pos_hauls_length <- dat_available_region2$pos_lengths/dat_available_region2$pos_hauls
ggplot(dat_available_region2, aes(y=prop_positive, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")
ggplot(dat_available_region2, aes(y=prop_positive, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Proportion of hauls with positive catch")
ggplot(dat_available_region2, aes(y=pos_hauls_length, x=as.factor(region)))+geom_col()+facet_wrap("species")+ylab("Proportion of positive catches with length data")
#Plot availability
#Make region an ordered factor
dat_available_region2$region <- as.factor(dat_available_region2$region)
levels(dat_available_region2$region) <- c("WC", "BC", "GOA", "EBS", "NBS", "IPHC")
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
#Make region an ordered factor
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
dat_available_region2$region <- as.factor(dat_available_region2$region)
levels(dat_available_region2$region) <- c("WC", "BC", "GOA", "EBS", "NBS", "IPHC")
levels(dat_available_region2$region) <- c("WC", "BC", "GOA", "EBS", "NBS")
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
#Make region an ordered factor
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
dat_available_region2$region <- as.factor(dat_available_region2$region)
levels(dat_available_region2$region) <- c("WC", "BC", "GOA", "EBS", "NBS")
#Add column of number of positive catch hauls with lengths
dat_available_region2$pos_lengths <- dat_available_region2$total_n_hauls*(1-dat_available_region2$prop_no_lengths)
#Add column of number of positive catch hauls with lengths
dat_available_region2$pos_lengths <- dat_available_region2$total_n_hauls*(1-dat_available_region2$prop_no_lengths)
#Column with number of hauls with positive catch
dat_available_region2$pos_hauls <- dat_available_region2$total_n_hauls*dat_available_region2$prop_positive
#Proportion of positive catches with length data
dat_available_region2$pos_hauls_length <- dat_available_region2$pos_lengths/dat_available_region2$pos_hauls
#Plot proportion of hauls with positive catch
ggplot(dat_available_region2, aes(y=prop_positive, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Proportion of hauls with positive catch")
#Plot proportion of positive catch hauls with length data
ggplot(dat_available_region2, aes(y=pos_hauls_length, x=as.factor(region)))+geom_col()+facet_wrap("species")+ylab("Proportion of positive catches with length data")
#Number of hauls with positive catch
ggplot(dat_available_region2, aes(y=pos_hauls, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Number of hauls with positive catch")
#Number of hauls with length data
ggplot(dat_available_region2, aes(y=pos_lengths, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Number of hauls with length data")
#Combine dataframes of each region for each species
dat_available_region2 <- list()
View(dat_available_region)
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
#Make region an ordered factor
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
dat_available_region2$region <- as.factor(dat_available_region2$region)
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
#Make region an ordered factor
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
?as.factor
dat_available_region2$region <- as.factor(dat_available_region2$region, ordered=c("WC", "BC", "GOA", "EBS", "NBS"))
View(dat_available_region2)
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
#Make region an ordered factor
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
#Add column of number of catches with length data
dat_available_region2$pos_lengths <- dat_available_region2$total_n_hauls*(1-dat_available_region2$prop_no_lengths)
#Column with number of hauls with positive catch
dat_available_region2$pos_hauls <- dat_available_region2$total_n_hauls*dat_available_region2$prop_positive
#Proportion of positive catches with length data
dat_available_region2$pos_hauls_length <- dat_available_region2$pos_lengths/dat_available_region2$pos_hauls
#Plot proportion of hauls with positive catch
ggplot(dat_available_region2, aes(y=prop_positive, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Proportion of hauls with positive catch")
factor(dat_available_region2$region, c("WC", "BC", "GOA", "EBS", "NBS"))
#Plot proportion of hauls with positive catch
ggplot(dat_available_region2, aes(y=prop_positive, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Proportion of hauls with positive catch")
dat_available_region2 <-factor(dat_available_region2$region, c("WC", "BC", "GOA", "EBS", "NBS"))
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
#Make region an ordered factor
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
dat_available_region2$region2 <-factor(dat_available_region2$region, c("WC", "BC", "GOA", "EBS", "NBS"))
View(dat_available_region2)
#Combine for all species
dat_available_region <- bind_rows(dat_available_region2)
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region <- bind_rows(dat_available_region2)
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Loop through each species and region
dat_available_region <- list()
for(i in 1:length(dataframes)){
dats <- group_split(dataframes[[i]], region)
summary <- list()
species <- spcs[i]
for(j in 1:length(dats)){
dat <- as.data.frame(dats[[j]])
dat2 <- positive_catches(dat)
name <- paste(unique(dat$region))
dat2 <- as.data.frame(dat2)
summary[[name]] <- dat2
}
dat_available_region[[species]] <- summary
}
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region <- bind_rows(dat_available_region2)
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
#Make region an ordered factor
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
dat_available_region2$region2 <-factor(dat_available_region2$region, c("WC", "BC", "GOA", "EBS", "NBS"))
dat_available_region2$region <-factor(dat_available_region2$region, c("WC", "BC", "GOA", "EBS", "NBS"))
#Add column of number of catches with length data
dat_available_region2$pos_lengths <- dat_available_region2$total_n_hauls*(1-dat_available_region2$prop_no_lengths)
#Column with number of hauls with positive catch
dat_available_region2$pos_hauls <- dat_available_region2$total_n_hauls*dat_available_region2$prop_positive
#Proportion of positive catches with length data
dat_available_region2$pos_hauls_length <- dat_available_region2$pos_lengths/dat_available_region2$pos_hauls
#Plot proportion of hauls with positive catch
ggplot(dat_available_region2, aes(y=prop_positive, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Proportion of hauls with positive catch")
#Number of hauls with length data
ggplot(dat_available_region2, aes(y=pos_lengths, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Number of hauls with length data")
#Number of hauls with positive catch
ggplot(dat_available_region2, aes(y=pos_hauls, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Number of hauls with positive catch")
#Number of p
#Plot proportion of positive catch hauls with length data
ggplot(dat_available_region2, aes(y=pos_hauls_length, x=as.factor(region)))+geom_col()+facet_wrap("species")+ylab("Proportion of positive catches with length data")
View(dat_available_region2)
source("/Users/jindiv/Library/CloudStorage/Dropbox/choke species/code/choke-species-data/code/wa_state/util_funs.R")
#Loop through each species and region
dat_available_region <- list()
for(i in 1:length(dataframes)){
dats <- group_split(dataframes[[i]], region)
summary <- list()
species <- spcs[i]
for(j in 1:length(dats)){
dat <- as.data.frame(dats[[j]])
dat2 <- positive_catches(dat)
name <- paste(unique(dat$region))
dat2 <- as.data.frame(dat2)
summary[[name]] <- dat2
}
dat_available_region[[species]] <- summary
}
#Combine dataframes of each region for each species
dat_available_region2 <- list()
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
#Make region an ordered factor
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
dat_available_region2$region <-factor(dat_available_region2$region, c("WC", "BC", "GOA", "EBS", "NBS"))
#Add column of number of catches with length data
dat_available_region2$pos_lengths <- dat_available_region2$total_n_hauls*(1-dat_available_region2$prop_no_lengths)
#Plot proportion of hauls with positive catch
ggplot(dat_available_region2, aes(y=prop_positive_hauls, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Proportion of hauls with positive catch")
#Number of hauls with length data
ggplot(dat_available_region2, aes(y=prop_hauls_length, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Number of hauls with length data")
#Number of hauls with positive catch
ggplot(dat_available_region2, aes(y=total_positive_hauls, x=as.factor(region)))+geom_col()+geom_col(mapping=aes(x=as.factor(region), y=total_hauls_with_length), colour="blue")+facet_wrap("species")+xlab("Region")+ylab("Number of hauls with positive catch")
#Number of hauls with positive catch
ggplot(dat_available_region2, aes(y=total_positive_hauls, x=as.factor(region)))+geom_col()+geom_col(mapping=aes(x=as.factor(region), y=total_hauls_with_length), fill="yellow4")+facet_wrap("species")+xlab("Region")+ylab("Number of hauls with positive catch")
#Number of hauls with positive catch
ggplot(dat_available_region2, aes(y=total_positive_hauls, x=as.factor(region)))+geom_col()+geom_col(mapping=aes(x=as.factor(region), y=total_hauls_with_length), fill="orange3")+facet_wrap("species")+xlab("Region")+ylab("Number of hauls with positive catch")
#Number of hauls with length data
ggplot(dat_available_region2, aes(y=prop_hauls_length, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Prop of positive catches with length data")
View(dat_available_region2)
View(dataframes2)
dataframes2[["walleye pollock_bs"]]
test <- dataframes2[["walleyepollock_bs"]]
test <- dataframes2[["walleye pollock_bs"]]
View(test)
#Make list
sci_names <- c("gadus chalcogrammus", "anoplopoma fimbria", "microstomus pacificus", "eopsetta jordani", "gadus macrocephalus", "sebastolobus altivelis", "sebastolobus alascanus", "hippoglossus stenolepis", "sebastes pinniger", "ophiodon elongatus", "sebastes crameri", "atheresthes stomias", "merluccius productus", "sebastes entomelas","sebastes ruberrimus","sebastes maliger", "glyptocephalus zachirus", "hippoglossoides elassodon", "parophrys vetulus", "lepidopsetta bilineata", "sebastes aleutianus")
spcs <- c("walleye pollock", "sablefish", "dover sole", "petrale sole", "pacific cod", "longspine thornyhead", "shortspine thornyhead", "pacific halibut", "canary rockfish", "lingcod", "darkblotched rockfish",  "arrowtooth flounder", "pacific hake", "widow rockfish","yelloweye rockfish", "quillback rockfish", "rex sole", "flathead sole", "english sole", "southern rock sole", "rougheye rockfish")
#Apply to multiple species
dataframes <- list()
for(i in 1:length(sci_names)){
message( "Preparing ", spcs[i], Sys.time() )
dat <- prepare_data(spcs[i], sci_names[i], ROMS=F)
}
#Separate each by region
dataframes2 <- list()
#Loop through each species and region
dat_available_region <- list()
for(i in 1:length(dataframes)){
dats <- group_split(dataframes[[i]], region)
summary <- list()
species <- spcs[i]
for(j in 1:length(dats)){
dat <- as.data.frame(dats[[j]])
dat2 <- positive_catches(dat)
name <- paste(unique(dat$region))
dat2 <- as.data.frame(dat2)
summary[[name]] <- dat2
}
dat_available_region[[species]] <- summary
}
#Apply to multiple species
dataframes <- list()
for(i in 1:length(sci_names)){
message( "Preparing ", spcs[i], Sys.time() )
dat <- prepare_data(spcs[i], sci_names[i], ROMS=F)
}
#Loop through each species and region
dat_available_region <- list()
for(i in 1:length(dataframes)){
dats <- group_split(dataframes[[i]], region)
summary <- list()
species <- spcs[i]
for(j in 1:length(dats)){
dat <- as.data.frame(dats[[j]])
dat2 <- positive_catches(dat)
name <- paste(unique(dat$region))
dat2 <- as.data.frame(dat2)
summary[[name]] <- dat2
}
dat_available_region[[species]] <- summary
}
#Apply to multiple species
dataframes <- list()
for(i in 1:length(sci_names)){
message( "Preparing ", spcs[i], Sys.time() )
dat <- prepare_data(spcs[i], sci_names[i], ROMS=F)
name <- paste(spcs[i])
dataframes[[name]] <- dat
}
#Loop through each species and region
dat_available_region <- list()
for(i in 1:length(dataframes)){
dats <- group_split(dataframes[[i]], region)
summary <- list()
species <- spcs[i]
for(j in 1:length(dats)){
dat <- as.data.frame(dats[[j]])
dat2 <- positive_catches(dat)
name <- paste(unique(dat$region))
dat2 <- as.data.frame(dat2)
summary[[name]] <- dat2
}
dat_available_region[[species]] <- summary
}
View(dat_available_region)
#Combine dataframes of each region for each species
dat_available_region2 <- list()
View(dat_available_region)
for(i in 1:length(dat_available_region)){
dat <- bind_rows(dat_available_region[[i]])
dat$species <- spcs[[i]]
if(length(dat_available_region[[i]])==5){
dat$region <- c("BC", "EBS", "GOA", "NBS", "WC")
}
if(length(dat_available_region[[i]])==6){
dat$region <- c("BC", "EBS", "GOA", "IPHC", "NBS", "WC")
}
dat_available_region2[[i]] <- dat
}
#Combine for all species
dat_available_region2 <- bind_rows(dat_available_region2)
#Plot availability
#Make region an ordered factor
dat_available_region2 <- subset(dat_available_region2, region!="IPHC")
dat_available_region2$region <-factor(dat_available_region2$region, c("WC", "BC", "GOA", "EBS", "NBS"))
#Plot proportion of hauls with positive catch
ggplot(dat_available_region2, aes(y=prop_positive_hauls, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Proportion of hauls with positive catch")
View(dat_available_region2)
#Number of hauls with length data
ggplot(dat_available_region2, aes(y=prop_hauls_length, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Prop of positive catches with length data")
#Number of hauls with length data
ggplot(dat_available_region2, aes(y=prop_hauls_length, x=as.factor(region)))+geom_col()+facet_wrap("species")+xlab("Region")+ylab("Prop of positive catches with length data")
#Number of hauls with positive catch
ggplot(dat_available_region2, aes(y=total_positive_hauls, x=as.factor(region)))+geom_col()+geom_col(mapping=aes(x=as.factor(region), y=total_hauls_with_length), fill="orange3")+facet_wrap("species")+xlab("Region")+ylab("Number of hauls with positive catch")
#Plot proportion of positive catch hauls with length data
ggplot(dat_available_region2, aes(y=pos_hauls_length, x=as.factor(region)))+geom_col()+facet_wrap("species")+ylab("Proportion of positive catches with length data")
View(dat_available_region)
View(dat_available2)
View(dat_available_region2)
